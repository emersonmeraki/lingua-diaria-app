<!DOCTYPE html>
<html lang="pt-BR" class=""> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Língua Diária - Aprenda Inglês Todos os Dias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Cor de fundo do modo claro */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        /* Estilos base para o modo escuro */
        .dark body {
            background-color: #1f2937; /* Tailwind gray-800 */
            color: #d1d5db; /* Tailwind gray-300 */
        }
        .dark .card {
            background-color: #374151; /* Tailwind gray-700 */
            border-color: #4b5563; /* Tailwind gray-600 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        .dark .text-gray-800 { color: #d1d5db; } 
        .dark .text-gray-700 { color: #9ca3af; } 
        .dark .text-gray-600 { color: #cbd5e1; } 
        .dark .text-gray-500 { color: #a1a1aa; } 
        .dark .text-indigo-600 { color: #a5b4fc; } 
        .dark .text-indigo-700 { color: #818cf8; } 
        .dark .hover\:text-indigo-800:hover { color: #6366f1; } 
        .dark .bg-white { background-color: #374151; } 
        .dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.5), 0 2px 4px -1px rgba(0,0,0,0.3); }
        .dark .border-yellow-300 { border-color: #fcd34d; } 
        .dark .bg-yellow-100 { background-color: #4f4629; } 
        .dark .text-yellow-700 { color: #fef08a; } 
        .dark .bg-green-100 { background-color: #224b3b; }
        .dark .text-green-700 { color: #6ee7b7; }
        .dark .border-green-300 { border-color: #34d399; }
        .dark .bg-red-100 { background-color: #5f2120; }
        .dark .text-red-700 { color: #fca5a5; }
        .dark .border-red-300 { border-color: #f87171; }
        .dark .bg-blue-100 { background-color: #1e3a8a; }
        .dark .text-blue-700 { color: #93c5fd; }
        .dark .border-blue-300 { border-color: #60a5fa; }
        .dark .bg-purple-100 { background-color: #581c87; }
        .dark .text-purple-700 { color: #d8b4fe; }
        .dark .border-purple-300 { border-color: #c084fc; }
        .dark .header-subtitle { color: #e5e7eb; } 
        .dark .footer-text { color: #9ca3af; } 

        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        @media (min-width: 640px) {
            .card {
                margin-bottom: 2rem;
            }
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
            cursor: pointer;
            text-align: center;
        }
        .btn-primary {
            background-color: #4f46e5; 
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca; 
        }
        .btn-primary:disabled {
            background-color: #a5b4fc; 
            cursor: not-allowed;
        }
        .dark .btn-primary:disabled {
            background-color: #6b7280; 
        }
        .btn-secondary {
            background-color: #e0e7ff; 
            color: #3730a3; 
        }
        .btn-secondary:hover {
            background-color: #c7d2fe; 
        }
        .dark .btn-secondary {
            background-color: #4338ca; 
            color: #e0e7ff; 
        }
        .dark .btn-secondary:hover {
            background-color: #4f46e5; 
        }

        .progress-section-container {
            position: relative;
        }
        .progress-bar-wrapper {
            width: 100%;
            background-color: #e5e7eb; 
            border-radius: 0.75rem;
            overflow: hidden;
            height: 2rem;
            position: relative;
        }
        .dark .progress-bar-wrapper {
            background-color: #4b5563; 
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, #4f46e5 0%, #818cf8 100%);
            height: 100%;
            transition: width 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            position: relative;
            z-index: 1;
        }
        .progress-bar-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            background-color: #ffffff;
            border: 3px solid #4f46e5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: left 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
            left: 0%;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .dark .progress-bar-icon {
            background-color: #e0e7ff; 
            border-color: #818cf8;
        }
        .progress-bar-icon svg {
            width: 16px;
            height: 16px;
            fill: #4f46e5;
        }
        .dark .progress-bar-icon svg {
            fill: #4338ca;
        }

        .content-container {
            position: relative;
            overflow: hidden; 
            max-width: 100%;
            background: #e2e8f0; 
            border-radius: 0.5rem;
            min-height: 200px; 
        }
        .dark .content-container {
            background: #4b5563; 
        }
        .content-container iframe,
        .content-container img {
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
            border-radius: 0.5rem; 
        }
        .interactive-page-iframe {
            width: 100%; 
            height: 100%; 
            border: none; 
            border-radius: 0.5rem;
        }

        .file-input-label {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            background-color: #10b981; 
            color: white;
            cursor: pointer;
            display: inline-block;
            transition: background-color 0.3s ease;
        }
        .file-input-label:hover {
            background-color: #059669; 
        }
        .dark .file-input-label {
            background-color: #059669; 
        }
        .dark .file-input-label:hover {
            background-color: #047857; 
        }
        #import-progress-input {
            display: none;
        }
        .action-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
        }
        @media (min-width: 640px) {
            .action-buttons-container {
                flex-direction: row;
                justify-content: center;
                gap: 0.75rem;
            }
        }
        .quote-author {
            font-size: 0.875rem; 
            color: #4b5563; 
            margin-top: 0.25rem; 
            text-align: right;
        }
        .dark .quote-author {
            color: #9ca3af; 
        }

        /* Estilos do Botão WhatsApp */
        .whatsapp-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center; 
        }
        .whatsapp-callout {
            background-color: #075E54; 
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.875rem; 
            margin-bottom: 12px; 
            white-space: nowrap;
            position: relative; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0; 
            transform: translateY(10px); 
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none; 
        }
        .whatsapp-container:hover .whatsapp-callout { 
            opacity: 1;
            transform: translateY(0);
        }
        .dark .whatsapp-callout {
            background-color: #128C7E; 
        }
        .whatsapp-callout::after { 
            content: "";
            position: absolute;
            top: 100%; 
            left: 50%;
            transform: translateX(-50%);
            border-width: 7px;
            border-style: solid;
            border-color: #075E54 transparent transparent transparent; 
        }
        .dark .whatsapp-callout::after {
            border-color: #128C7E transparent transparent transparent;
        }

        .whatsapp-fab {
            background-color: #25D366; /* Cor verde do WhatsApp */
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .whatsapp-fab:hover {
            background-color: #1DAE52; /* Verde mais escuro no hover */
            transform: scale(1.1);
        }
        .whatsapp-fab svg {
            width: 32px; /* Ajuste o tamanho do SVG se necessário */
            height: 32px;
            fill: white; /* Cor do ícone SVG */
        }
       
        .header-actions button, .header-actions a {
            background: none; border: none; cursor: pointer; padding: 0.5rem;
            border-radius: 0.375rem; transition: background-color 0.2s ease-in-out;
            color: #4b5563; 
        }
        .dark .header-actions button, .dark .header-actions a { color: #d1d5db; }
        .header-actions button:hover, .header-actions a:hover { background-color: rgba(0,0,0,0.1); }
        .dark .header-actions button:hover, .dark .header-actions a:hover { background-color: rgba(255,255,255,0.1); }
        .header-actions svg { width: 24px; height: 24px; fill: currentColor; }
        .dark .bg-gray-800 { background-color: #111827; } 
        .dark .text-white { color: #f3f4f6; } 

        .header-subtitle {
            font-size: 0.875rem; color: #4b5563; text-align: center; 
        }
        @media (min-width: 640px) { .header-subtitle { text-align: left; } }
        .footer-text { font-size: 0.875rem; color: #6b7280; }

    </style>
</head>
<body class="text-gray-800 antialiased">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-indigo-600 text-center sm:text-left">Língua Diária</h1>
                    <p class="header-subtitle mt-1">Fazendo você aprender com dedicação, paixão e carinho.</p>
                </div>
                <div class="header-actions flex items-center space-x-2 mt-2 sm:mt-0">
                    <a href="https://www.youtube.com" target="_blank" rel="noopener noreferrer" aria-label="Nosso Canal no YouTube" title="Canal no YouTube">
                        <svg viewBox="0 0 24 24"> <path d="M21.582,6.186c-0.23-0.86-0.908-1.538-1.768-1.768C18.25,4,12,4,12,4S5.75,4,4.186,4.418 c-0.86,0.23-1.538,0.908-1.768,1.768C2,7.75,2,12,2,12s0,4.25,0.418,5.814c0.23,0.86,0.908,1.538,1.768,1.768 C5.75,20,12,20,12,20s6.25,0,7.814-0.418c0.861-0.23,1.538-0.908,1.768-1.768C22,16.25,22,12,22,12S22,7.75,21.582,6.186z M9.996,15.006V8.994l5.217,3.006L9.996,15.006z"/>
                        </svg>
                    </a>
                    <button id="theme-toggle" aria-label="Alternar tema" title="Alternar Tema">
                        <svg id="theme-toggle-dark-icon" class="hidden" viewBox="0 0 24 24"> <path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"></path>
                        </svg>
                        <svg id="theme-toggle-light-icon" class="hidden" viewBox="0 0 24 24"> <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 py-6 sm:py-8">

        <section id="motivation-section" class="card">
            <h2 class="text-lg sm:text-xl font-semibold mb-3 text-gray-700">Frase do Dia</h2>
            <blockquote id="quote-container">
                <p id="quote-text" class="text-base sm:text-lg italic text-gray-600 mb-1">Carregando frase...</p>
                <p id="quote-author" class="quote-author mb-2 hidden"></p> 
            </blockquote>
            <p id="quote-translation" class="text-sm text-gray-500 mb-3 hidden"></p>
            <button id="translate-button" class="btn btn-secondary text-sm">Mostrar Tradução</button>
        </section>

        <section id="progress-section" class="card progress-section-container">
            <h2 class="text-lg sm:text-xl font-semibold mb-3 text-gray-700">Seu Progresso de Aprendizado</h2>
            <div class="progress-bar-wrapper mb-2">
                <div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%;">0%</div>
                <div id="progress-bar-icon" class="progress-bar-icon" style="left: 0%;">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                </div>
            </div>
            <p id="progress-text" class="text-center text-sm sm:text-base text-gray-600">Complete a introdução para começar!</p>
            <div class="mt-4 action-buttons-container">
                <button id="export-progress-button" class="btn btn-secondary text-sm w-full sm:w-auto">Exportar Progresso (JSON)</button>
                <label for="import-progress-input" class="btn btn-secondary text-sm file-input-label w-full sm:w-auto">Importar Progresso (JSON)</label>
                <input type="file" id="import-progress-input" accept=".json">
            </div>
        </section>

        <main id="lesson-area" class="card">
            <h2 id="lesson-title" class="text-xl sm:text-2xl font-bold mb-4 text-indigo-700">Carregando...</h2>
            
            <div id="lesson-content-area" class="mb-6">
                <div id="lesson-content-embed" class="content-container mb-4">
                    <img src="https://placehold.co/1600x900/e2e8f0/64748b?text=Carregando+Conte%C3%BAdo..." alt="Carregando conteúdo" class="w-full h-full object-cover">
                </div>
                <div id="lesson-materials-container" class="mb-4 hidden">
                    <h3 class="text-base sm:text-lg font-semibold mb-2 text-gray-700">Recursos Adicionais:</h3>
                    <a id="lesson-materials-link" href="#" target="_blank" class="text-indigo-600 hover:text-indigo-800 hover:underline"></a>
                </div>
            </div>

            <div id="lesson-message" class="mb-4 p-3 rounded-md hidden text-sm sm:text-base"></div>
            
            <button id="complete-lesson-button" class="btn btn-primary w-full sm:w-auto">Marcar como Concluída</button>
            <p id="course-completed-message" class="mt-4 text-green-600 font-semibold hidden">Parabéns! Você concluiu todas as aulas de aprendizado!</p>
        </main>
    </div>

    <footer class="mt-12 py-8 bg-gray-800 text-white text-center">
        <p class="footer-text">© <span id="currentYear"></span> Língua Diária. Todos os direitos reservados.</p>
        <p class="footer-text mt-2">Seu aprendizado é nossa maior inspiração. Continue firme!</p>
    </footer>

    <div class="whatsapp-container">
        <span class="whatsapp-callout">Tire suas dúvidas!</span>
        <a href="https://wa.me/5574988592119" class="whatsapp-fab" target="_blank" rel="noopener noreferrer" aria-label="Fale conosco no WhatsApp">
            <svg viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 2.672C8.64 2.672 2.672 8.64 2.672 16S8.64 29.328 16 29.328 29.328 23.36 29.328 16 23.36 2.672 16 2.672ZM22.336 18.856C22.032 19.728 21.072 20.304 20.184 20.448C19.536 20.568 18.6 20.52 17.904 20.232C17.208 19.944 15.144 19.056 13.08 17.208C10.608 14.928 9.096 12.336 8.904 11.976C8.712 11.616 7.944 10.344 7.944 9.288C7.944 8.232 8.4 7.752 8.688 7.488C8.952 7.248 9.312 7.152 9.6 7.152C9.768 7.152 9.912 7.152 10.032 7.176C10.296 7.2 10.488 7.248 10.68 7.608C10.896 8 11.352 9.072 11.448 9.24C11.544 9.408 11.616 9.6 11.52 9.816C11.424 10.032 11.328 10.128 11.16 10.32C11.016 10.488 10.872 10.656 10.752 10.776C10.632 10.92 10.512 11.088 10.656 11.328C10.8 11.568 11.304 12.312 12.072 13.008C13.104 13.944 13.944 14.496 14.328 14.712C14.64 14.88 14.88 14.856 15.072 14.64C15.288 14.4 15.48 14.064 15.672 13.8C15.888 13.512 16.152 13.464 16.416 13.56C16.68 13.632 17.736 14.16 18.096 14.328C18.48 14.52 18.72 14.592 18.816 14.712C18.912 14.832 18.912 15.12 18.816 15.336C18.744 15.528 18.24 16.032 17.88 16.44C17.52 16.824 17.256 17.112 17.256 17.4C17.256 17.688 17.544 17.952 17.856 18.216C18.168 18.48 18.96 18.888 19.344 19.008C19.728 19.128 20.256 19.44 20.544 19.44C20.832 19.44 21.072 19.272 21.792 18.408C21.888 18.288 22.336 18.856 22.336 18.856Z"/>
            </svg>
        </a>
    </div>

    <script>
        // --- CONFIGURAÇÕES ---
        const IS_DEVELOPMENT_MODE = true; 
        const TOTAL_LEARNING_DAYS = 277; 
        const APP_STORAGE_KEY = 'linguaDiariaProgress';
        const THEME_STORAGE_KEY = 'linguaDiariaTheme';
        const INTRO_VIDEO_ID = "dQw4w9WgXcQ"; // ID do vídeo de introdução do YouTube

        // --- Array de Frases Motivacionais ---
        let dailyMotivationalQuotes = [];
        dailyMotivationalQuotes[1] = { day: 1, en: "The journey of a thousand miles begins with a single step.", pt: "A jornada de mil milhas começa com um único passo.", author: "Lao Tzu" };
        dailyMotivationalQuotes[2] = { day: 2, en: "Don't watch the clock; do what it does. Keep going.", pt: "Não observe o relógio; faça o que ele faz. Continue andando.", author: "Sam Levenson" };
        // Preenche as demais frases (até 277) para garantir que existam
        for (let i = 3; i <= 277; i++) {
            if (!dailyMotivationalQuotes[i]) { // Adiciona apenas se não existir para não sobrescrever
                dailyMotivationalQuotes[i] = { 
                    day: i, 
                    en: `Motivational Quote for Day ${i} - Remember to add specific content.`, 
                    pt: `Frase Motivacional para o Dia ${i} - Lembre-se de adicionar conteúdo específico.`, 
                    author: "System Placeholder" 
                };
            }
        }
        
        // --- Dados das Lições ---
        const lessonsData = [
            // Lição de introdução
            { id: 'intro', type: 'intro', title: "Bem-vindo à Língua Diária!", videoId: INTRO_VIDEO_ID },
            // Lições dos dias (sem links de materiais PDF)
            { id: 1, type: 'interactive_page', title: "Dia 1: Os Fundamentos Essenciais", pageUrl: "aulas/dia1.html" }, 
            { id: 2, type: 'interactive_page', title: "Dia 2: Primeiras Conversas", pageUrl: "aulas/dia2.html" },
        ];
        // Adiciona as demais lições programaticamente
        for (let i = 3; i <= TOTAL_LEARNING_DAYS; i++) {
            lessonsData.push({
                id: i,
                type: 'interactive_page',
                title: `Dia ${i}: Tópico da Aula ${i}`, 
                pageUrl: `aulas/dia${i}.html`, 
                // Não há mais 'materialsLink' ou 'materialsText' aqui
            });
        }

        // --- ELEMENTOS DO DOM (Referências aos elementos HTML) ---
        const quoteTextEl = document.getElementById('quote-text');
        const quoteAuthorEl = document.getElementById('quote-author');
        const quoteTranslationEl = document.getElementById('quote-translation');
        const translateButton = document.getElementById('translate-button');
        const progressBarFillEl = document.getElementById('progress-bar-fill');
        const progressBarIconEl = document.getElementById('progress-bar-icon');
        const progressTextEl = document.getElementById('progress-text');
        const lessonTitleEl = document.getElementById('lesson-title');
        const lessonContentEmbedEl = document.getElementById('lesson-content-embed'); // Div que contém o iframe/imagem da aula
        const lessonMaterialsContainerEl = document.getElementById('lesson-materials-container'); // Container para materiais (agora não usado)
        const lessonMaterialsLinkEl = document.getElementById('lesson-materials-link'); // Link para materiais (agora não usado)
        const completeLessonButton = document.getElementById('complete-lesson-button');
        const lessonMessageEl = document.getElementById('lesson-message');
        const courseCompletedMessageEl = document.getElementById('course-completed-message');
        const currentYearEl = document.getElementById('currentYear');
        const exportProgressButton = document.getElementById('export-progress-button');
        const importProgressInput = document.getElementById('import-progress-input');
        const themeToggleButton = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

        // --- ESTADO DA APLICAÇÃO (Variáveis globais) ---
        let currentQuoteObject = null; // Objeto da citação atual
        let translationVisible = false; // Controla visibilidade da tradução da citação
        let userProgress = { // Progresso do usuário
            introCompleted: false,
            currentLearningDay: 1, 
            lastActivityDate: null 
        };

        // --- FUNÇÕES ---

        // Função para aplicar o tema (claro/escuro)
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark'); // Adiciona classe 'dark' ao HTML
                themeToggleDarkIcon.classList.remove('hidden'); // Mostra ícone de sol
                themeToggleLightIcon.classList.add('hidden');  // Esconde ícone de lua
            } else {
                document.documentElement.classList.remove('dark'); // Remove classe 'dark'
                themeToggleDarkIcon.classList.add('hidden');    // Esconde ícone de sol
                themeToggleLightIcon.classList.remove('hidden'); // Mostra ícone de lua
            }
        }

        // Função para alternar o tema
        function toggleTheme() {
            const currentTheme = localStorage.getItem(THEME_STORAGE_KEY);
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            localStorage.setItem(THEME_STORAGE_KEY, newTheme); // Salva preferência no localStorage
            applyTheme(newTheme);
        }
        
        // Função para carregar o tema salvo ou preferência do sistema
        function loadTheme() {
            const preferredTheme = localStorage.getItem(THEME_STORAGE_KEY);
            if (preferredTheme) {
                applyTheme(preferredTheme);
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                applyTheme('dark'); // Usa tema escuro se for preferência do sistema
            }
            else {
                applyTheme('light'); // Padrão para tema claro
            }
        }

        // Função para exibir a citação motivacional diária
        function displayDailyQuote() {
            let quoteToDisplay;
            if (!userProgress.introCompleted) {
                quoteToDisplay = { en: "Welcome! Complete the intro to begin your daily quotes.", pt: "Bem-vindo! Complete a introdução para começar suas frases diárias.", author: "Língua Diária" };
            } else if (userProgress.currentLearningDay > TOTAL_LEARNING_DAYS) {
                quoteToDisplay = { en: "Congratulations on completing your learning journey!", pt: "Parabéns por completar sua jornada de aprendizado!", author: "Língua Diária" };
            } else if (userProgress.currentLearningDay >= 1 && 
                       userProgress.currentLearningDay < dailyMotivationalQuotes.length && 
                       dailyMotivationalQuotes[userProgress.currentLearningDay] && 
                       dailyMotivationalQuotes[userProgress.currentLearningDay].en) {
                quoteToDisplay = dailyMotivationalQuotes[userProgress.currentLearningDay];
            } else {
                // Fallback se a citação não for encontrada
                console.warn(`Quote for day ${userProgress.currentLearningDay} not found. Using placeholder.`);
                quoteToDisplay = {
                    en: `English Quote for Day ${userProgress.currentLearningDay} - (Content missing)`,
                    pt: `Tradução para o Dia ${userProgress.currentLearningDay} - (Conteúdo ausente)`,
                    author: "Sistema"
                };
            }
            currentQuoteObject = quoteToDisplay;
            quoteTextEl.textContent = `"${currentQuoteObject.en}"`;
            if (currentQuoteObject.author) {
                quoteAuthorEl.textContent = `- ${currentQuoteObject.author}`;
                quoteAuthorEl.classList.remove('hidden');
            } else {
                quoteAuthorEl.classList.add('hidden');
            }
            quoteTranslationEl.textContent = currentQuoteObject.pt;
            quoteTranslationEl.classList.add('hidden'); // Tradução começa escondida
            translateButton.textContent = 'Mostrar Tradução';
            translationVisible = false;
        }

        // Função para mostrar/ocultar a tradução da citação
        function toggleTranslation() {
            translationVisible = !translationVisible;
            quoteTranslationEl.classList.toggle('hidden', !translationVisible);
            translateButton.textContent = translationVisible ? 'Ocultar Tradução' : 'Mostrar Tradução';
        }

        // Função para carregar o progresso do usuário do localStorage
        function loadProgress() {
            const savedProgress = localStorage.getItem(APP_STORAGE_KEY);
            if (savedProgress) {
                try {
                    const parsedProgress = JSON.parse(savedProgress);
                    // Validação básica dos dados carregados
                    if (typeof parsedProgress.introCompleted === 'boolean' &&
                        typeof parsedProgress.currentLearningDay === 'number' &&
                        parsedProgress.currentLearningDay >= 1 &&
                        (parsedProgress.lastActivityDate === null || (typeof parsedProgress.lastActivityDate === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(parsedProgress.lastActivityDate)))
                       ) {
                        userProgress = parsedProgress;
                    } else {
                        console.warn("Progresso salvo inválido. Usando padrão.");
                        saveProgress(); // Salva o progresso padrão se o carregado for inválido
                    }
                } catch (error) {
                    console.error("Erro ao carregar progresso:", error);
                    // Mantém o progresso padrão inicializado em caso de erro
                }
            }
        }

        // Função para salvar o progresso do usuário no localStorage
        function saveProgress() {
            localStorage.setItem(APP_STORAGE_KEY, JSON.stringify(userProgress));
        }

        // Função para atualizar a barra de progresso
        function updateProgressBar() {
            let daysEffectivelyCompleted = 0;
            if (userProgress.introCompleted) {
                daysEffectivelyCompleted = Math.max(0, userProgress.currentLearningDay - 1);
            }
            const percentage = userProgress.introCompleted ? Math.min(100, (daysEffectivelyCompleted / TOTAL_LEARNING_DAYS) * 100) : 0;
            progressBarFillEl.style.width = `${percentage}%`;
            progressBarFillEl.textContent = `${Math.floor(percentage)}%`;
            
            // Ajusta a posição do ícone na barra de progresso
            let iconLeftPercentage;
            if (percentage >= 97) { // Evita que o ícone saia da barra no final
                iconLeftPercentage = `calc(100% - 28px)`; 
            } else if (percentage < 3 && percentage > 0) { // Evita que o ícone saia da barra no início
                 iconLeftPercentage = `0%`;
            } else {
                iconLeftPercentage = `${percentage}%`;
            }
            progressBarIconEl.style.left = iconLeftPercentage;

            // Atualiza o texto da barra de progresso
            if (!userProgress.introCompleted) {
                progressTextEl.textContent = "Complete a introdução para iniciar sua jornada!";
            } else if (daysEffectivelyCompleted >= TOTAL_LEARNING_DAYS) {
                progressTextEl.textContent = `Parabéns! Você concluiu todos os ${TOTAL_LEARNING_DAYS} dias de aprendizado!`;
                progressBarIconEl.style.left = `calc(100% - 28px)`; // Garante ícone no final
            } else {
                progressTextEl.textContent = `Dia ${daysEffectivelyCompleted} de ${TOTAL_LEARNING_DAYS} concluídos. Próxima aula: Dia ${userProgress.currentLearningDay}.`;
            }
        }
        
        // Função para obter a data atual no formato YYYY-MM-DD
        function getTodayDateString() {
            const today = new Date();
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        }

        // Função para carregar o conteúdo da lição na UI
        function loadLessonContentUI(lesson) {
            lessonTitleEl.textContent = lesson.title;
            lessonContentEmbedEl.innerHTML = ''; // Limpa conteúdo anterior

            // Reseta estilos do container para cada tipo de conteúdo
            lessonContentEmbedEl.style.paddingBottom = '';
            lessonContentEmbedEl.style.height = '';
            lessonContentEmbedEl.style.overflow = 'hidden'; 

            if (lesson.type === 'intro') {
                // Estilo para vídeo de introdução (mantém aspect ratio 16:9)
                lessonContentEmbedEl.style.paddingBottom = '56.25%'; 
                lessonContentEmbedEl.style.height = '0'; 

                if (lesson.videoId && lesson.videoId !== "your_youtube_intro_video_id" && !lesson.videoId.startsWith("placeholder")) {
                    lessonContentEmbedEl.innerHTML = `<iframe src="https://www.youtube.com/watch?v=1_eKyE_mHrg&pp=0gcJCdgAo7VqN5tD{lesson.videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen title="${lesson.title}"></iframe>`;
                } else {
                    // Placeholder se o ID do vídeo não estiver configurado
                    lessonContentEmbedEl.innerHTML = `<img src="https://placehold.co/1600x900/e2e8f0/64748b?text=Configure+o+V%C3%ADdeo+de+Introdu%C3%A7%C3%A3o" alt="Vídeo de introdução" class="w-full h-full object-cover rounded-md">`;
                }
            } else if (lesson.type === 'interactive_page') {
                // Estilo para página interativa (iframe expandido)
                lessonContentEmbedEl.style.height = '75vh'; // Define altura para "expandir"

                if (lesson.pageUrl) {
                    const pageUrlWithCacheBuster = IS_DEVELOPMENT_MODE ? `${lesson.pageUrl}?t=${new Date().getTime()}` : lesson.pageUrl;
                    lessonContentEmbedEl.innerHTML = `<iframe src="${pageUrlWithCacheBuster}" title="${lesson.title}" class="interactive-page-iframe"></iframe>`;
                } else {
                    // Mensagem se a URL da página da aula não estiver configurada
                    lessonContentEmbedEl.innerHTML = `<p class="p-4 text-center">Conteúdo da página interativa não configurado (pageUrl ausente para o dia ${lesson.id}).</p>`;
                    lessonContentEmbedEl.style.height = 'auto'; // Altura automática para mensagem de erro
                }
            }

            // Gerenciamento de materiais adicionais (agora sempre esconde, pois foram removidos dos dados)
            if (lesson.materialsLink && lesson.materialsText) {
                lessonMaterialsLinkEl.href = lesson.materialsLink;
                lessonMaterialsLinkEl.textContent = lesson.materialsText;
                lessonMaterialsContainerEl.classList.remove('hidden');
            } else {
                lessonMaterialsContainerEl.classList.add('hidden'); // Garante que está escondido
            }
        }

        // Função para gerenciar a exibição da lição atual e controles
        function manageLessonDisplayAndControls() {
            lessonMessageEl.classList.add('hidden'); // Esconde mensagens anteriores
            lessonMessageEl.textContent = '';
            courseCompletedMessageEl.classList.add('hidden'); // Esconde mensagem de curso completo
            completeLessonButton.classList.remove('hidden'); // Mostra botão de completar
            completeLessonButton.disabled = false; // Habilita botão
            
            let currentLessonToShow;
            let lessonIdentifier; 

            if (!userProgress.introCompleted) {
                // Se a introdução não foi completada, mostra a introdução
                currentLessonToShow = lessonsData.find(l => l.id === 'intro');
                lessonIdentifier = 'intro';
                completeLessonButton.textContent = "Concluir Introdução";
            } else {
                // Se a introdução foi completada
                if (userProgress.currentLearningDay > TOTAL_LEARNING_DAYS) {
                    // Se todas as aulas foram completadas
                    lessonTitleEl.textContent = "Jornada Concluída!";
                    lessonContentEmbedEl.innerHTML = '<div class="p-4 text-center"><p class="text-lg text-green-600 dark:text-green-400">Fantástico! Você dominou todos os dias de aprendizado!</p><p class="mt-2 text-gray-700 dark:text-gray-300">Continue praticando para solidificar seu conhecimento.</p></div>';
                    lessonContentEmbedEl.style.paddingBottom = '0'; 
                    lessonContentEmbedEl.style.height = 'auto'; 
                    lessonMaterialsContainerEl.classList.add('hidden');
                    completeLessonButton.classList.add('hidden'); // Esconde botão de completar
                    courseCompletedMessageEl.classList.remove('hidden'); // Mostra mensagem de curso completo
                    updateProgressBar();
                    return;
                }
                // Mostra a aula do dia atual
                currentLessonToShow = lessonsData.find(l => l.id === userProgress.currentLearningDay && l.type === 'interactive_page');
                lessonIdentifier = userProgress.currentLearningDay;
                completeLessonButton.textContent = `Marcar Dia ${userProgress.currentLearningDay} como Concluído`;
            }

            if (!currentLessonToShow) {
                // Se a aula não for encontrada (erro de configuração)
                lessonTitleEl.textContent = "Erro de Aula";
                lessonContentEmbedEl.innerHTML = `<p class='p-4 text-center text-red-600 dark:text-red-400'>Oops! Aula para '${lessonIdentifier}' não encontrada. Por favor, verifique.</p>`;
                lessonContentEmbedEl.style.paddingBottom = '0';
                lessonContentEmbedEl.style.height = 'auto'; 
                completeLessonButton.classList.add('hidden');
                return;
            }

            loadLessonContentUI(currentLessonToShow); // Carrega o conteúdo da aula

            // Verifica se a atividade do dia já foi completada (exceto em modo de desenvolvimento)
            const todayStr = getTodayDateString();
            if (userProgress.lastActivityDate === todayStr && !IS_DEVELOPMENT_MODE) {
                let message = "";
                if (lessonIdentifier === 'intro' && userProgress.introCompleted) { 
                     message = `Introdução concluída hoje! Volte amanhã para iniciar o Dia 1.`;
                } 
                else if (lessonIdentifier !== 'intro' && userProgress.currentLearningDay > 1) { 
                    const previousDayCompleted = userProgress.currentLearningDay -1;
                    message = `Você já completou a atividade de hoje (Dia ${previousDayCompleted}). Volte amanhã para o Dia ${userProgress.currentLearningDay}!`;
                }
                if (message) {
                    lessonMessageEl.textContent = message;
                    lessonMessageEl.className = 'mb-4 p-3 bg-blue-100 text-blue-700 border border-blue-300 rounded-md text-sm sm:text-base dark:bg-blue-800 dark:text-blue-200 dark:border-blue-600';
                    lessonMessageEl.classList.remove('hidden');
                    completeLessonButton.disabled = true; // Desabilita botão
                    completeLessonButton.textContent = "Volte Amanhã";
                }
            } else if (IS_DEVELOPMENT_MODE && userProgress.lastActivityDate === todayStr) {
                // Mensagem para modo de desenvolvimento
                lessonMessageEl.textContent = `(Modo de Teste) Atividade diária já registrada para ${todayStr}, mas você pode continuar.`;
                lessonMessageEl.className = 'mb-4 p-3 bg-purple-100 text-purple-700 border border-purple-300 rounded-md text-sm sm:text-base dark:bg-purple-800 dark:text-purple-200 dark:border-purple-600';
                lessonMessageEl.classList.remove('hidden');
            }
        }

        // Função para lidar com a conclusão de uma lição
        function handleCompleteLesson() {
            const todayStr = getTodayDateString();
            lessonMessageEl.className = 'mb-4 p-3 border rounded-md text-sm sm:text-base hidden'; // Reseta classes da mensagem
            
            // Impede completar mais de uma atividade por dia (exceto em modo de desenvolvimento)
            if (userProgress.lastActivityDate === todayStr && !IS_DEVELOPMENT_MODE) {
                lessonMessageEl.textContent = `Você só pode completar uma atividade por dia. Volte amanhã!`;
                lessonMessageEl.classList.add('bg-yellow-100', 'text-yellow-700', 'border-yellow-300', 'dark:bg-yellow-700', 'dark:text-yellow-200', 'dark:border-yellow-500');
                lessonMessageEl.classList.remove('hidden');
                completeLessonButton.disabled = true;
                return;
            }

            let messageAfterCompletion = "";
            if (!userProgress.introCompleted) {
                // Completa a introdução
                userProgress.introCompleted = true;
                messageAfterCompletion = `Introdução concluída!`;
                if (IS_DEVELOPMENT_MODE) {
                    messageAfterCompletion += ` (Modo de Teste) Próxima aula (Dia 1) já está disponível.`;
                } else {
                    messageAfterCompletion += ` Você está pronto para começar o Dia 1.`;
                }
            } else { 
                // Completa uma aula regular
                if (userProgress.currentLearningDay <= TOTAL_LEARNING_DAYS) {
                    const dayJustCompleted = userProgress.currentLearningDay;
                    userProgress.currentLearningDay += 1; // Avança para o próximo dia
                    
                    if (dayJustCompleted >= TOTAL_LEARNING_DAYS) { 
                        // Se completou a última aula
                        messageAfterCompletion = `Parabéns! Dia ${dayJustCompleted} concluído. Você finalizou todas as aulas de aprendizado!`;
                    } else { 
                        messageAfterCompletion = `Dia ${dayJustCompleted} concluído!`;
                        if (IS_DEVELOPMENT_MODE) {
                            messageAfterCompletion += ` (Modo de Teste) Próxima aula (Dia ${userProgress.currentLearningDay}) já está disponível.`;
                        } else {
                            messageAfterCompletion += ` Volte amanhã para o Dia ${userProgress.currentLearningDay}.`;
                        }
                    }
                }
            }

            // Exibe mensagem de conclusão
            if (messageAfterCompletion) {
                lessonMessageEl.textContent = messageAfterCompletion;
                lessonMessageEl.classList.add('bg-green-100', 'text-green-700', 'border-green-300', 'dark:bg-green-800', 'dark:text-green-200', 'dark:border-green-600');
                lessonMessageEl.classList.remove('hidden');
            }

            userProgress.lastActivityDate = todayStr; // Registra a data da atividade
            saveProgress(); // Salva o progresso
            displayDailyQuote(); // Atualiza a citação
            updateProgressBar(); // Atualiza a barra de progresso
            manageLessonDisplayAndControls(); // Atualiza a exibição da lição
        }

        // Função para exportar o progresso como JSON
        function exportProgress() {
            const progressJson = JSON.stringify(userProgress, null, 2); // Formata o JSON para leitura
            const blob = new Blob([progressJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lingua_diaria_progresso.json'; // Nome do arquivo
            document.body.appendChild(a);
            a.click(); // Simula o clique para download
            document.body.removeChild(a); // Remove o elemento 'a'
            URL.revokeObjectURL(url); // Libera o objeto URL

            // Mensagem de sucesso
            lessonMessageEl.textContent = "Seu progresso foi exportado como 'lingua_diaria_progresso.json'. Guarde este arquivo!";
            lessonMessageEl.className = 'mb-4 p-3 bg-green-100 text-green-700 border border-green-300 rounded-md text-sm sm:text-base dark:bg-green-800 dark:text-green-200 dark:border-green-600';
            lessonMessageEl.classList.remove('hidden');
        }

        // Função para importar o progresso de um arquivo JSON
        function importProgress(event) {
            const file = event.target.files[0];
            lessonMessageEl.className = 'mb-4 p-3 border rounded-md text-sm sm:text-base hidden'; // Reseta mensagem
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedProgress = JSON.parse(e.target.result);
                    // Validação básica do progresso importado
                    if (typeof importedProgress.introCompleted === 'boolean' &&
                        typeof importedProgress.currentLearningDay === 'number' &&
                        importedProgress.currentLearningDay >= 1 &&
                        importedProgress.currentLearningDay <= (TOTAL_LEARNING_DAYS + 1) && // Permite importar até o estado "concluído"
                        (importedProgress.lastActivityDate === null || (typeof importedProgress.lastActivityDate === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(importedProgress.lastActivityDate)))
                       ) {
                        userProgress = importedProgress;
                        saveProgress();
                        displayDailyQuote();
                        updateProgressBar();
                        manageLessonDisplayAndControls();
                        lessonMessageEl.textContent = "Progresso importado com sucesso!";
                        lessonMessageEl.classList.add('bg-green-100', 'text-green-700', 'border-green-300', 'dark:bg-green-800', 'dark:text-green-200', 'dark:border-green-600');
                    } else {
                        lessonMessageEl.textContent = "Arquivo de progresso inválido ou corrompido.";
                        lessonMessageEl.classList.add('bg-red-100', 'text-red-700', 'border-red-300', 'dark:bg-red-800', 'dark:text-red-200', 'dark:border-red-600');
                    }
                } catch (error) {
                    console.error("Erro ao importar progresso:", error);
                    lessonMessageEl.textContent = "Erro ao ler o arquivo de progresso: " + error.message;
                    lessonMessageEl.classList.add('bg-red-100', 'text-red-700', 'border-red-300', 'dark:bg-red-800', 'dark:text-red-200', 'dark:border-red-600');
                } finally {
                    lessonMessageEl.classList.remove('hidden');
                    importProgressInput.value = ""; // Limpa o input de arquivo
                }
            };
            reader.readAsText(file); // Lê o arquivo como texto
        }

        // Função de inicialização da aplicação
        function initApp() {
            currentYearEl.textContent = new Date().getFullYear(); // Define o ano atual no rodapé
            
            loadTheme(); // Carrega o tema
            themeToggleButton.addEventListener('click', toggleTheme); // Adiciona evento ao botão de tema

            translateButton.addEventListener('click', toggleTranslation); // Adiciona evento ao botão de tradução
            
            loadProgress(); // Carrega o progresso do usuário
            displayDailyQuote(); // Exibe a citação do dia
            updateProgressBar(); // Atualiza a barra de progresso
            manageLessonDisplayAndControls(); // Gerencia a exibição da lição atual

            // Adiciona eventos aos botões de completar, exportar e importar
            completeLessonButton.addEventListener('click', handleCompleteLesson);
            exportProgressButton.addEventListener('click', exportProgress);
            importProgressInput.addEventListener('change', importProgress);

            if (IS_DEVELOPMENT_MODE) {
                console.log("Língua Diária rodando em MODO DE DESENVOLVIMENTO.");
            }
        }

        // Inicializa a aplicação quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
